import React, { useState, useEffect, useRef } from 'react';
import { initializeApp } from 'firebase/app';
import { 
  getAuth, 
  signInWithEmailAndPassword, 
  onAuthStateChanged, 
  signOut, 
  setPersistence, 
  browserLocalPersistence 
} from 'firebase/auth';
import { 
  getFirestore, 
  doc, 
  getDoc, 
  setDoc 
} from 'firebase/firestore';
import { Line } from 'react-chartjs-2';
import {
  Chart as ChartJS,
  CategoryScale,
  LinearScale,
  PointElement,
  LineElement,
  Title,
  Tooltip,
  Legend,
  Filler
} from 'chart.js';

// Registro de componentes para las gráficas
ChartJS.register(
  CategoryScale,
  LinearScale,
  PointElement,
  LineElement,
  Title,
  Tooltip,
  Legend,
  Filler
);

// --- CONFIGURACIÓN DE FIREBASE ---
const firebaseConfig = {
    apiKey: "AIzaSyAJBf7TbP1GuAoA3GsrCG0EJOifEt4YodY",
    authDomain: "imnufit-cad14.firebaseapp.com",
    projectId: "imnufit-cad14",
    storageBucket: "imnufit-cad14.firebasestorage.app",
    messagingSenderId: "65610345018",
    appId: "1:65610345018:web:eac15a30c72084faac6303"
};

// --- CONFIGURACIÓN DE APIS EXTERNAS ---
const AIRTABLE_PAT = "patZ9QUQVyldn9zKC.afb4fc362eb2f79b1aa10faf3fb3268ea6bca3f57a1362b83f6cc8459a50f0d3";
const AIRTABLE_BASE_ID = "appCHcm7XPzeoyBCs";
const TABLE_PACIENTES = "Pacientes";
const TABLE_CONSULTAS = "Consulta de control";

// --- API KEY DE GOOGLE AI (GEMINI) ---
const apiKey = "AIzaSyDwUn86PQpIZlTFDYhY33PMg3YkgbS3iqc"; 

const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db = getFirestore(app);
const appId = "imnufit-web";

// Función para convertir PCM a WAV (Necesario para Gemini TTS)
function pcmToWav(pcmData, sampleRate) {
  const buffer = new ArrayBuffer(44 + pcmData.length * 2);
  const view = new DataView(buffer);
  const writeString = (o, s) => { for (let i = 0; i < s.length; i++) view.setUint8(o + i, s.charCodeAt(i)); };
  writeString(0, 'RIFF');
  view.setUint32(4, 32 + pcmData.length * 2, true);
  writeString(8, 'WAVE');
  writeString(12, 'fmt ');
  view.setUint32(16, 16, true);
  view.setUint16(20, 1, true);
  view.setUint16(22, 1, true);
  view.setUint32(24, sampleRate, true);
  view.setUint32(28, sampleRate * 2, true);
  view.setUint16(32, 2, true);
  view.setUint16(34, 16, true);
  writeString(36, 'data');
  view.setUint32(40, pcmData.length * 2, true);
  for (let i = 0; i < pcmData.length; i++) view.setInt16(44 + i * 2, pcmData[i], true);
  return new Blob([buffer], { type: 'audio/wav' });
}

export default function App() {
  const [user, setUser] = useState(null);
  const [view, setView] = useState('login'); 
  const [loading, setLoading] = useState(true);
  const [patientData, setPatientData] = useState(null);
  const [history, setHistory] = useState([]);
  const [aiInstructions, setAiInstructions] = useState("Eres el Asistente Virtual de IMNUFIT. Tu misión es guiar a los pacientes con su plan nutricional, resolver dudas logísticas, motivarlos y mantener un tono amable y espiritual.");
  const [chatOpen, setChatOpen] = useState(false);
  const [messages, setMessages] = useState([{ role: 'ai', text: '¡Hola! Soy tu Asistente Virtual de IMNUFIT. ¿En qué puedo apoyarte hoy?' }]);
  const [isAiTalking, setIsAiTalking] = useState(false);
  const [toast, setToast] = useState({ show: false, msg: '', type: 'success' });
  const chatEndRef = useRef(null);

  useEffect(() => {
    setPersistence(auth, browserLocalPersistence);
    const unsubscribe = onAuthStateChanged(auth, async (user) => {
      if (user) {
        setUser(user);
        await loadData(user.email);
        setView('dashboard');
      } else {
        setUser(null);
        setView('login');
      }
      setLoading(false);
    });
    return () => unsubscribe();
  }, []);

  useEffect(() => {
    chatEndRef.current?.scrollIntoView({ behavior: 'smooth' });
  }, [messages]);

  const showToast = (msg, type = 'success') => {
    setToast({ show: true, msg, type });
    setTimeout(() => setToast(prev => ({ ...prev, show: false })), 3000);
  };

  const loadData = async (email) => {
    const formula = encodeURIComponent(`({Email}='${email}')`);
    
    try {
      // CORRECCIÓN: Ruta con número par de segmentos para cumplir con las reglas de Firestore
      // Segments: artifacts (1), appId (2), public (3), data (4), settings (5), ai_config (6)
      const aiDoc = await getDoc(doc(db, 'artifacts', appId, 'public', 'data', 'settings', 'ai_config'));
      if (aiDoc.exists()) setAiInstructions(aiDoc.data().prompt);
    } catch(e) { console.error("Error cargando configuración", e); }

    try {
      const resC = await fetch(`https://api.airtable.com/v0/${AIRTABLE_BASE_ID}/${TABLE_CONSULTAS}?filterByFormula=${formula}&sort[0][field]=Fecha&sort[0][direction]=asc`, {
        headers: { Authorization: `Bearer ${AIRTABLE_PAT}` }
      });
      const dataC = await resC.json();
      setHistory(dataC.records || []);
      
      const resP = await fetch(`https://api.airtable.com/v0/${AIRTABLE_BASE_ID}/${TABLE_PACIENTES}?filterByFormula=${formula}`, {
        headers: { Authorization: `Bearer ${AIRTABLE_PAT}` }
      });
      const dataP = await resP.json();
      setPatientData(dataP.records?.[0]?.fields || null);
    } catch (e) { 
        showToast("Error al sincronizar datos", "error");
    }
  };

  const handleLogin = async (e) => {
    e.preventDefault();
    try { 
      await signInWithEmailAndPassword(auth, e.target.email.value, e.target.pass.value); 
    } catch (err) { 
      showToast("Credenciales incorrectas", "error");
    }
  };

  // --- LÓGICA DE IA CON ACCESO A TODOS LOS CAMPOS ---
  const sendMessage = async (text) => {
    if (!text || isAiTalking) return;
    const newMsgs = [...messages, { role: 'user', text }];
    setMessages(newMsgs);
    setIsAiTalking(true);
    
    // Obtener el registro más reciente
    const latestRecord = history.length > 0 ? history[history.length - 1].fields : null;
    
    // CONVERTIR TODOS LOS CAMPOS DISPONIBLES EN TEXTO PARA LA IA
    let fullClinicalContext = "INFORMACIÓN DEL PACIENTE:\n";
    if (patientData) {
        Object.entries(patientData).forEach(([key, value]) => {
            fullClinicalContext += `- ${key}: ${value}\n`;
        });
    }

    fullClinicalContext += "\nDATOS DE LA ÚLTIMA CONSULTA (TODOS LOS CAMPOS):\n";
    if (latestRecord) {
        Object.entries(latestRecord).forEach(([key, value]) => {
            fullClinicalContext += `- ${key}: ${value}\n`;
        });
    } else {
        fullClinicalContext += "No hay registros de consulta previos.\n";
    }
    
    const systemPrompt = `
        ${aiInstructions}
        
        REGLAS DE ORO:
        - Analiza TODOS los campos proporcionados abajo para responder. 
        - Si el paciente pregunta algo sobre su salud, revisa los datos clínicos.
        - Sé motivador, directo y utiliza un tono empático.
        - Usa voz femenina amable (Aoede).
        
        ${fullClinicalContext}
    `;

    try {
      const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-tts:generateContent?key=${apiKey}`, {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({
          contents: [{ parts: [{ text: text }] }],
          generationConfig: { 
            responseModalities: ["AUDIO"],
            speechConfig: { voiceConfig: { prebuiltVoiceConfig: { voiceName: "Aoede" } } } 
          },
          systemInstruction: { parts: [{ text: systemPrompt }] }
        })
      });
      const result = await response.json();
      const aiText = result.candidates?.[0]?.content?.parts?.[0]?.text;
      const audioData = result.candidates?.[0]?.content?.parts?.find(p => p.inlineData)?.inlineData;

      setMessages([...newMsgs, { role: 'ai', text: aiText || "Dime de nuevo, por favor." }]);

      if (audioData) {
        const binaryString = atob(audioData.data);
        const bytes = new Int16Array(binaryString.length / 2);
        for (let i = 0; i < bytes.length; i++) {
          bytes[i] = binaryString.charCodeAt(i * 2) | (binaryString.charCodeAt(i * 2 + 1) << 8);
        }
        const audio = new Audio(URL.createObjectURL(pcmToWav(bytes, 24000)));
        audio.onended = () => setIsAiTalking(false);
        audio.play();
      } else {
        setIsAiTalking(false);
      }
    } catch (e) { 
      setMessages([...newMsgs, { role: 'ai', text: "Error de conexión con el Asistente." }]);
      setIsAiTalking(false);
    }
  };

  const startSpeech = () => {
    const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
    if (SpeechRecognition) {
      const recognition = new SpeechRecognition();
      recognition.lang = 'es-ES';
      recognition.onresult = (e) => sendMessage(e.results[0][0].transcript);
      recognition.start();
    } else { showToast("Voz no soportada", "error"); }
  };

  const chartData = {
    labels: history.map(r => new Date(r.fields.Fecha).toLocaleDateString('es-ES', { day: '2-digit', month: 'short' })),
    datasets: [
      {
        label: 'IMC',
        data: history.map(r => r.fields.IMC),
        borderColor: '#2E4982',
        backgroundColor: 'rgba(46, 73, 130, 0.1)',
        fill: true,
        tension: 0.4
      },
      {
        label: '% Grasa',
        data: history.map(r => r.fields['%IGC']),
        borderColor: '#10B981',
        borderDash: [5, 5],
        tension: 0.4
      }
    ]
  };

  if (loading) return (
    <div className="h-screen flex items-center justify-center bg-white">
      <div className="flex flex-col items-center gap-4">
        <div className="animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-[#2E4982]"></div>
        <p className="text-[10px] font-bold text-slate-400 uppercase tracking-widest italic">Sincronizando con IMNUFIT...</p>
      </div>
    </div>
  );

  return (
    <div className="min-h-screen bg-[#FBFBFC] font-sans selection:bg-[#DEE9FA]">
      
      {/* PANEL ADMINISTRADOR */}
      {user?.email === "imnufit@gmail.com" && (
        <div className="bg-[#2E4982] text-white p-3 flex justify-between items-center px-6 sticky top-0 z-50 shadow-md">
          <div className="flex items-center gap-2">
            <div className="w-2 h-2 rounded-full bg-emerald-400 animate-pulse"></div>
            <span className="text-[10px] font-black uppercase tracking-widest">Panel de Control IMNUFIT</span>
          </div>
          <button onClick={() => setView(view === 'admin' ? 'dashboard' : 'admin')} className="text-[10px] font-bold bg-white/20 px-4 py-1 rounded-full hover:bg-white/30 transition-all">
            {view === 'admin' ? 'Volver' : '⚙️ Entrenar Asistente'}
          </button>
        </div>
      )}

      {/* HEADER GLOBAL */}
      {view !== 'login' && (
        <header className="h-20 bg-white/70 backdrop-blur-xl border-b flex items-center justify-between px-6 sticky top-0 z-40">
          <img src="https://imnufit.com/wp-content/uploads/2025/05/cropped-logo-y-nombre-AZUL.png" className="h-8 object-contain cursor-pointer mix-blend-multiply" onClick={() => setView('dashboard')} />
          <div className="flex items-center gap-4">
            <button onClick={() => setView('analytics')} title="Evolución" className="p-2 text-slate-400 hover:text-[#2E4982] transition-colors">
              <svg className="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"/></svg>
            </button>
            <button onClick={() => signOut(auth)} className="text-[10px] font-bold text-slate-400 uppercase tracking-widest hover:text-red-500">Salir</button>
          </div>
        </header>
      )}

      {toast.show && (
        <div className={`fixed top-24 left-1/2 -translate-x-1/2 z-[100] px-6 py-3 rounded-full shadow-2xl text-xs font-bold bg-white border ${toast.type === 'success' ? 'text-emerald-600 border-emerald-100' : 'text-red-600 border-red-100'} animate-fade-in`}>
          {toast.msg}
        </div>
      )}

      {/* LOGIN */}
      {view === 'login' && (
        <div className="h-screen flex items-center justify-center p-6 bg-mesh relative overflow-hidden">
          <div className="max-w-[340px] w-full space-y-8 animate-fade-in text-center relative z-10">
            <img src="https://imnufit.com/wp-content/uploads/2025/05/cropped-logo-y-nombre-AZUL.png" className="mx-auto h-12 mix-blend-multiply" />
            <div className="space-y-2">
              <h1 className="text-2xl font-bold tracking-tight">Portal del Paciente</h1>
              <p className="text-sm text-slate-500">Inicia sesión para ver tu progreso</p>
            </div>
            <form onSubmit={handleLogin} className="space-y-4">
              <input name="email" type="email" placeholder="Correo electrónico" required className="w-full p-4 rounded-2xl border border-slate-200 focus:ring-4 focus:ring-[#DEE9FA] outline-none text-center" />
              <input name="pass" type="password" placeholder="Contraseña" required className="w-full p-4 rounded-2xl border border-slate-200 focus:ring-4 focus:ring-[#DEE9FA] outline-none text-center" />
              <button className="w-full bg-[#2E4982] text-white py-5 rounded-full font-bold shadow-xl hover:scale-[1.02] transition-transform">Acceder al Portal</button>
            </form>
          </div>
        </div>
      )}

      {/* DASHBOARD */}
      {view === 'dashboard' && (
        <main className="max-w-5xl mx-auto p-6 md:p-12 space-y-12 animate-fade-in text-left">
          <section className="space-y-1">
            <p className="text-[10px] font-bold text-[#2E4982] uppercase tracking-[0.4em]">Mi Resumen</p>
            <h2 className="text-3xl font-bold tracking-tight text-slate-800">Hola, {patientData?.["Nombre + Edad"]?.split(' ')[0] || 'Bienvenido'}</h2>
            <div className="pt-2">
              <span className={`px-4 py-1.5 rounded-full text-[10px] font-black uppercase tracking-widest ${patientData?.Estatus?.includes('Inactivo') ? 'bg-rose-50 text-red-600 border border-rose-100' : 'bg-emerald-50 text-emerald-600 border border-emerald-100'}`}>
                {patientData?.Estatus || 'Activo'}
              </span>
            </div>
          </section>

          <div className="grid grid-cols-1 md:grid-cols-2 gap-8">
            <div className="bg-white p-10 rounded-[45px] shadow-sm border border-slate-100 flex flex-col justify-between cursor-pointer group hover:shadow-xl transition-all" onClick={() => setView('analytics')}>
              <div>
                <h4 className="text-[10px] font-bold text-slate-400 uppercase tracking-widest mb-1">Tu Evolución</h4>
                <h3 className="text-xl font-bold group-hover:text-[#2E4982]">Gráfica Metabólica</h3>
              </div>
              <div className="h-32 mt-8">
                <Line data={chartData} options={{ maintainAspectRatio: false, plugins: { legend: { display: false } }, scales: { x: { display: false }, y: { display: false } } }} />
              </div>
              <p className="text-[10px] text-center text-slate-300 mt-6 font-bold uppercase tracking-widest">Ver análisis detallado</p>
            </div>

            <div className="bg-[#2E4982] p-10 rounded-[45px] shadow-2xl text-white flex flex-col justify-between relative overflow-hidden">
              <div className="absolute -right-20 -top-20 w-64 h-64 bg-white/10 rounded-full blur-3xl"></div>
              <div className="relative z-10">
                <h4 className="text-[10px] font-bold text-white/50 uppercase tracking-widest mb-1 text-left">Control</h4>
                <h3 className="text-xl font-bold text-left">Agenda tu Próxima Cita</h3>
                <p className="text-sm text-white/60 mt-3 leading-relaxed text-left">Sigue avanzando hacia tus objetivos de salud con nuestro apoyo.</p>
              </div>
              <a href="https://calendar.app.google/CE4KjKxPeFiV93GV7" target="_blank" className="mt-10 block w-full text-center py-5 bg-white text-[#2E4982] rounded-full font-bold text-[11px] uppercase tracking-widest hover:scale-105 transition-transform shadow-lg relative z-10">Reservar Ahora</a>
            </div>
          </div>
        </main>
      )}

      {/* ANALYTICS */}
      {view === 'analytics' && (
        <main className="max-w-4xl mx-auto p-6 md:p-12 space-y-12 animate-fade-in">
          <div className="bg-white p-8 md:p-12 rounded-[50px] shadow-xl border border-slate-50">
            <h3 className="text-2xl font-bold text-[#2E4982] mb-12 text-center">Progreso de Composición</h3>
            <div className="h-80"><Line data={chartData} options={{ responsive: true, maintainAspectRatio: false, plugins: { legend: { position: 'bottom' } } }} /></div>
          </div>
          <div className="grid grid-cols-2 gap-6">
             <div className="bg-emerald-50 p-8 rounded-[40px] text-center border border-emerald-100 shadow-sm">
                <span className="text-[10px] font-bold text-emerald-600 uppercase tracking-widest">IMC Actual</span>
                <p className="text-4xl font-black text-emerald-800 mt-2">{history[history.length-1]?.fields.IMC || '--'}</p>
             </div>
             <div className="bg-blue-50 p-8 rounded-[40px] text-center border border-blue-100 shadow-sm">
                <span className="text-[10px] font-bold text-blue-600 uppercase tracking-widest">% Grasa</span>
                <p className="text-4xl font-black text-blue-800 mt-2">{history[history.length-1]?.fields['%IGC'] || '--'}%</p>
             </div>
          </div>
        </main>
      )}

      {/* ADMIN SETTINGS */}
      {view === 'admin' && (
        <main className="max-w-2xl mx-auto p-6 md:p-12 space-y-8 animate-fade-in text-left">
          <div className="bg-white p-12 rounded-[50px] shadow-2xl border border-slate-100 space-y-8">
            <div className="space-y-2">
              <h3 className="text-2xl font-bold tracking-tight text-slate-800">Instrucciones del Asistente</h3>
              <p className="text-sm text-slate-500">Lo que escribas aquí modificará el comportamiento del Asistente para todos tus pacientes.</p>
            </div>
            <textarea 
              value={aiInstructions}
              onChange={(e) => setAiInstructions(e.target.value)}
              className="w-full h-64 p-8 rounded-[35px] bg-slate-50 border-none outline-none focus:ring-4 focus:ring-[#DEE9FA] text-sm leading-relaxed text-slate-700"
              placeholder="Ej: Recuerda a todos que deben tomar un vaso de agua antes de cada comida..."
            />
            <button 
              onClick={async () => {
                setLoading(true);
                // CORRECCIÓN: Ruta con número par de segmentos para cumplir con las reglas de Firestore
                await setDoc(doc(db, 'artifacts', appId, 'public', 'data', 'settings', 'ai_config'), { prompt: aiInstructions, updatedAt: new Date().toISOString() });
                setLoading(false);
                showToast("Sincronizado con éxito", "success");
                setView('dashboard');
              }}
              className="w-full bg-[#2E4982] text-white py-6 rounded-full font-bold shadow-xl active:scale-95 transition-transform"
            >
              Guardar y Actualizar IA
            </button>
          </div>
        </main>
      )}

      {/* ASISTENTE VIRTUAL CHAT */}
      <div className="fixed bottom-8 right-8 z-[100]">
        <button 
          onClick={() => setChatOpen(!chatOpen)}
          className={`w-16 h-16 bg-[#2E4982] text-white rounded-full flex items-center justify-center shadow-2xl transition-all hover:scale-110 active:scale-90 ${chatOpen ? 'rotate-90 bg-slate-800' : ''}`}
        >
          {chatOpen ? <svg className="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path d="M6 18L18 6M6 6l12 12" strokeWidth="3"/></svg> : <svg className="w-8 h-8" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path d="M8 10h.01M12 10h.01M16 10h.01M9 16H5a2 2 0 01-2-2V6a2 2 0 012-2h14a2 2 0 012 2v8a2 2 0 01-2 2h-5l-5 5v-5z" strokeWidth="2" strokeLinecap="round"/></svg>}
        </button>
        
        {chatOpen && (
          <div className="absolute bottom-20 right-0 w-[340px] md:w-[400px] h-[580px] bg-white rounded-[40px] shadow-2xl border border-slate-100 flex flex-col overflow-hidden animate-fade-in">
            <header className="bg-[#2E4982] p-6 text-white flex justify-between items-center">
              <div className="text-left">
                <h5 className="font-bold tracking-tight text-sm">Asistente Virtual IMNUFIT</h5>
                <p className="text-[9px] opacity-60 uppercase font-black tracking-widest mt-0.5">Analizando tu historial médico</p>
              </div>
              <div className={`w-2.5 h-2.5 rounded-full bg-emerald-400 ${isAiTalking ? 'animate-ping' : ''}`}></div>
            </header>
            
            <div className="flex-1 p-6 overflow-y-auto space-y-5 bg-slate-50/50">
              {messages.map((m, i) => (
                <div key={i} className={`flex ${m.role === 'user' ? 'justify-end' : 'justify-start'}`}>
                  <div className={`p-4 rounded-[25px] text-[13px] max-w-[85%] leading-relaxed shadow-sm ${m.role === 'user' ? 'bg-[#2E4982] text-white rounded-tr-none text-right' : 'bg-white text-slate-700 rounded-tl-none border border-slate-100 text-left'}`}>
                    {m.text}
                  </div>
                </div>
              ))}
              <div ref={chatEndRef} />
            </div>

            <div className="p-5 bg-white border-t border-slate-100 flex gap-3 items-center">
              <button 
                onClick={startSpeech}
                className="w-12 h-12 bg-slate-100 text-[#2E4982] rounded-full flex items-center justify-center hover:bg-[#DEE9FA] transition-colors active:scale-90"
              >
                <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path d="M19 11a7 7 0 01-7 7m0 0a7 7 0 01-7-7m7 7v4m0 0H8m4 0h4m-4-8a3 3 0 01-3-3V5a3 3 0 116 0v6a3 3 0 01-3 3z" strokeWidth="2"/></svg>
              </button>
              <input 
                onKeyPress={(e) => e.key === 'Enter' && (sendMessage(e.target.value), e.target.value = '')}
                placeholder="Pregúntame lo que sea..." 
                className="flex-1 bg-slate-100 border-none rounded-full px-6 py-4 text-xs outline-none focus:ring-2 focus:ring-[#DEE9FA] text-slate-700" 
              />
              <button 
                className="w-12 h-12 bg-[#2E4982] text-white rounded-full flex items-center justify-center shadow-lg active:scale-90 transition-transform"
                onClick={() => {
                  const input = document.querySelector('input[placeholder="Pregúntame lo que sea..."]');
                  sendMessage(input.value);
                  input.value = '';
                }}
              >
                <svg className="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path d="M5 12h14M12 5l7 7-7 7" strokeWidth="3"/></svg>
              </button>
            </div>
          </div>
        )}
      </div>

      <style>{`
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        .animate-fade-in { animation: fadeIn 0.4s cubic-bezier(0.16, 1, 0.3, 1) forwards; }
        .bg-mesh { position: absolute; inset: 0; background: radial-gradient(circle at 80% 20%, #DEE9FA 0%, transparent 40%), radial-gradient(circle at 20% 80%, #E7E3FB 0%, transparent 40%); opacity: 0.5; z-index: 0; }
        .mix-blend-multiply { mix-blend-mode: multiply; }
      `}</style>

    </div>
  );
}
